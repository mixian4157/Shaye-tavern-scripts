# 莎夜健康状态界面 - 变量格式说明

## 变量路径

界面会从消息楼层变量中读取以下路径的数据：

### 生命值
- **当前值路径**: `stat_data.主角.健康状态.生命值`
- **上限路径**: `stat_data.主角.健康状态.生命值上限`
- **支持格式**:
  - 数字：直接作为当前值（例如：`85`）
  - 对象：包含 `当前`/`当前值` 属性
    ```json
    {
      "当前": 85
    }
    ```
    或
    ```json
    {
      "当前值": 85
    }
    ```
  - 上限值：从 `生命值上限` 变量读取（数字类型）

### 法力值
- **当前值路径**: `stat_data.主角.健康状态.法力值`
- **上限路径**: `stat_data.主角.健康状态.法力值上限`
- **支持格式**:
  - 数字：直接作为当前值（例如：`45`）
  - 对象：包含 `当前`/`当前值` 属性
    ```json
    {
      "当前": 45
    }
    ```
    或
    ```json
    {
      "当前值": 45
    }
    ```
  - 上限值：从 `法力值上限` 变量读取（数字类型）

### 理智值（可选）
- **当前值路径**: `stat_data.主角.健康状态.理智值`
- **上限路径**: `stat_data.主角.健康状态.理智值上限`
- **支持格式**:
  - 数字：直接作为当前值（例如：`60`）
  - 对象：包含 `当前`/`当前值` 属性
    ```json
    {
      "当前": 60
    }
    ```
    或
    ```json
    {
      "当前值": 60
    }
    ```
  - 上限值：从 `理智值上限` 变量读取（数字类型）

### 经验值（可选）
- **当前值路径**: `stat_data.主角.当前经验值`
- **上限路径**: `stat_data.主角.升级所需经验值`
- **支持格式**:
  - 数字：直接作为当前经验值（例如：`1250`）
  - 上限值：从 `升级所需经验值` 变量读取（数字类型）

### 健康描述（可选）
- **路径**: `stat_data.主角.健康状态.描述`
- **格式**: 字符串

## 示例变量结构

### 示例 1: 使用独立上限变量（推荐）
```yaml
stat_data:
  主角:
    健康状态:
      生命值: 85
      生命值上限: 120
      法力值: 45
      法力值上限: 80
      理智值: 60
      理智值上限: 100
      描述: "身体状况良好，精力充沛。"
  当前经验值: 1250
  升级所需经验值: 2000
```

### 示例 2: 使用对象格式（仅当前值）
```yaml
stat_data:
  主角:
    健康状态:
      生命值:
        当前: 85
      生命值上限: 120
      法力值:
        当前值: 45
      法力值上限: 80
    当前经验值: 1250
    升级所需经验值: 2000
```

### 示例 3: 使用数字格式（仅当前值）
```yaml
stat_data:
  主角:
    健康状态:
      生命值: 85
      生命值上限: 120
      法力值: 45
      法力值上限: 80
    当前经验值: 1250
    升级所需经验值: 2000
```

注意：如果未设置上限变量，会使用默认值（生命值上限 120，法力值上限 80，理智值上限 100，升级所需经验值 100）。

## 在酒馆中设置变量

### 方法 1: 通过世界书变量更新规则
在世界书中创建变量更新规则，例如：

```yaml
stat_data.主角.健康状态.生命值: 85
stat_data.主角.健康状态.生命值上限: 120
stat_data.主角.健康状态.理智值: 60
stat_data.主角.健康状态.理智值上限: 100
```

### 方法 2: 通过脚本设置
在脚本中使用 `updateVariablesWith` 或 `insertOrAssignVariables`：

```typescript
insertOrAssignVariables({
  stat_data: {
    主角: {
      健康状态: {
        生命值: 85,
        生命值上限: 120,
        法力值: 45,
        法力值上限: 80,
        理智值: 60,
        理智值上限: 100
      },
      当前经验值: 1250,
      升级所需经验值: 2000
    }
  }
}, { type: 'message', message_id: getCurrentMessageId() });
```

### 方法 3: 通过 AI 输出更新
在 AI 输出中使用变量更新语法（如果配置了变量更新规则）。

## 界面更新机制

界面会：
1. 在加载时读取一次变量
2. 每 500ms 自动检查变量变化并更新显示
3. 如果变量不存在，使用默认值

## 调试

如果界面没有正确显示数据：
1. 打开浏览器控制台（F12）
2. 查看是否有错误信息
3. 检查变量路径是否正确
4. 使用以下代码在控制台中检查变量：
   ```javascript
   // 在酒馆控制台中运行
   const msgId = getCurrentMessageId();
   const vars = getVariables({ type: 'message', message_id: msgId });
   console.log(_.get(vars, 'stat_data.主角.健康状态'));
   ```

